!function(t){"use strict";var e,s,i,r,n,a,o,h,l,f,u,c,d=1,p=2,g=["Change","Update"],m=["key","value"],v="data-column-key",y="@",b="#",C="?",A="function"===typeof Object.observe,S=/&/g,I=/</g,x=/>/g,k=/"/g,w=/'/g;e=function(t){var e=t;if(!e)i("invalidSettings");if(e.columns)this.columns=e.columns;if(e.columnAttributes)this.columnAttributes=e.columnAttributes;if(e.rowAttributes)this.rowAttributes=e.rowAttributes;if(e.table)this.setTable(e.table,e.body||0);if(e.exclude)this.exclude=e.exclude;this.sortClass=e.sortClass||"sorted";this.sortClassAscending=e.sortClassAscending||"sorted-asc";this.sortClassDescending=e.sortClassDescending||"sorted-desc";this.isRecursive="undefined"===typeof e.isRecursive?true:e.isRecursive;if(e.formatter)if("function"===typeof e.formatter)this.cellFormatter=e.formatter;else this.cellFormatter=this.formatCellHtml;if(e.compareItems)if("function"===typeof e.compareItems)this.compareItems=e.compareItems;this.setData(e.data);if(e.triggers)this.watchTriggers(e.triggers);if(e.onProcess)this.onProcess=e.onProcess;if(e.onCheckChange)this.onCheckChange=e.onCheckChange;n(this,this.updateEvents,e);if(e.pageSize){this.pageSize=e.pageSize;this.pageIndex=e.pageIndex||0}if(e.sortColumn){this.sort(e.sortColumn);this.update()}};e.prototype.updateEvents=g;e.prototype.generateBody=function(){var t=this.dataIsArray,e=t?this.dataSort||this.data:this.keys,s=this.isReversed,i=this.pageSize||0,r,n,a,o,h,l="";if(s){n=e.length-1;a=0;o=-1;if(i){n=Math.max(n-this.pageIndex*i,a);a=Math.max(n-i+1,0)}}else{a=i?Math.min((this.pageIndex+1)*i,e.length):e.length;n=i?this.pageIndex*i:0;o=1}for(r=n;s?r>=a:r<a;r+=o){h=e[r];if(t)l+=this.generateRowHtml(h,r);else l+=this.generateRowHtml(this.data,r,h)}return l};e.prototype.generateRowHtml=function(t,e,s){var i,r,n,a,o,h=this.sortColumn,l,f=this.columnAttributes,u=this.rowAttributes,c,g,v=this.columns,A=v?v.length:0,S=this.cellFormatter;if(s&&u){if(u[s])u=u?u[s]:null;c=u&&u.cellAttributes}r="<tr"+this.generateAttributeHtml(u)+">";for(i=0;i<A;i++){n=v[i];if(n===p)a=t[s];else if(n===d)a=s;else if(n===y)a=e.toString();else if(n===b)a=(e+1).toString();else if(n===C)a=this.generateCheckHtml(t);else{a=t[n];if(n===h)l=true}if(c)g=u.cellAttributes[m[i]];else g=f?f[n]:null;if(l){o=this.sortClass+" "+(this.isReversed?this.sortClassDescending:this.sortClassAscending);if(!g)g={};if(!g["class"])g["class"]=o;else g["class"]+=" "+o;l=false}r+="<td"+this.generateAttributeHtml(g)+">";r+=(S?S.call(this,a,n,t,e):a)+"</td>"}return r+"</tr>"};e.prototype.generateAttributeHtml=function(t,e){var s,i,r="";if(!!t&&"object"===typeof t)for(s in t)if(t.hasOwnProperty(s)&&"cellAttributes"!==s){i=this.formatCellHtml(t[s]);r+=" "+(e||"")+s+'="'+i+'"'}return r};e.prototype.generateCheckHtml=function(t){return'<input type="checkbox" '+this.generateAttributeHtml(t,"data-")+"/>"};e.prototype.formatCellJson=function(t){var e=JSON.stringify(t);return e};e.prototype.formatCellHtml=function(t){var e,s=t.toString();e=s.replace(S,"&amp;").replace(I,"&lt;").replace(x,"&gt;").replace(k,"&quot;").replace(w,"&#039;");return e};e.prototype.update=function(t){var e,s,i,r;e=this.generateBody();this.tableBody.innerHTML=e;if(this.onCheckChange)this.processChecks();if(t&&t.length)for(s=0;s<t.length;s++){i="on"+t[s];r=this[i];if("function"===typeof r)r.call(this)}};e.prototype.processChanges=function(t){if("function"===typeof this.onProcess)if(false===this.onProcess(t))return;if(this.dataSort)delete this.dataSort;if(!this.dataIsArray)this.keys=r(this.data,this.exclude||[]);this.sort(this.sortColumn);this.update(this.updateEvents)};e.prototype.sort=function(t){var e,s,i,r,n,a;if(!t)return;if(this.sortColumn!=t){this.isReversed=!this.sortColumn&&t==y;this.sortColumn=t}else this.isReversed=!this.isReversed;if(t==y)return;if(this.dataIsArray)this.dataSort=this.data.slice(0);else{i=t===m[0];if(i)this.dataSort=this.keys.slice(0);else{s=true;this.dataSort=[];n=this.keys||[];for(a=0;a<n.length;a++){r=n[a];this.dataSort.push({key:r,value:this.data[r]})}}}if(this.compareItems){e=this;this.dataSort.sort(function(t,i){if(s)return e.compareItems(t.value,i.value);else return e.compareItems(t,i)})}else this.dataSort.sort(function(e,r){if(s)return u(e.value,r.value);else return u(e,r,i?null:t)});if(s){this.keys=[];for(a=0;a<this.dataSort.length;a++){r=this.dataSort[a].key;this.keys.push(r)}}else if(i)this.keys=this.dataSort;this.updateHeader(t)};e.prototype.processChecks=function(){var t,e,s,i,r,n,a,o,h,l=this,f=this.tableBody;if(f&&f.rows){i=f.rows;for(t=0;t<i.length;t++){s=i[t];for(e=0;e<s.children.length;e++){r=s.children[e];o=r.children;h=-1;for(a=0;a<o.length;a++){n=o[a];if(n instanceof HTMLInputElement){h++;n.setAttribute("data-check-index",h.toString());n.addEventListener("change",function(t){var e=parseInt(n.getAttribute("data-check-index"),10);if("function"===typeof l.onCheckChange)l.onCheckChange.call(this,this.checked,e)})}}}}}};e.prototype.releaseData=function(){var t;if(this.data){t=this.data;delete this.data;delete this.dataIsArray;if(this.observeChanges){Object.unobserve(t,this.observeChanges);delete this.observeChanges}}if(this.dataSort)delete this.dataSort};e.prototype.setData=function(t){var e=this;this.releaseData();if("undefined"===typeof t||"string"===typeof t)return this.setData(this.getDataFromTable(t));else if(t){this.data=t;this.dataIsArray=t instanceof Array;if(!this.dataIsArray){this.keys=r(t,this.exclude||[]);this.columns=[d,p]}if(A){this.observeChanges=function(t){e.processChanges(t)};l(function(t){Object.observe(t,e.observeChanges)},!this.isRecursive)(t)}}this.sort(this.sortColumn)};e.prototype.getDataFromTable=function(t){var e=[],s,i,r,n,a,o,h,l=this.tableBody,f=this.columns;if(t){l=document.getElementById(t);if(l)l=l.tBodies[0]}if(l&&f){h=l.rows;if(h)for(s=0;s<h.length;s++){r=h[s];n={};for(i=0;i<r.children.length;i++){o=r.children[i].getAttribute("data-column-type");a=r.children[i].innerText;if(o){o=o.toLowerCase();if("date"===o)a=new Date(a);else if("number"===o)a=parseFloat(a)}if(f.length>0&&i<f.length)n[f[i]]=a}e.push(n)}}return e};e.prototype.setTable=function(t,e){if("string"===typeof t&&"undefined"!==typeof document)this.table=document.getElementById(t);else this.table=t;if(!this.table instanceof HTMLTableElement)i("invalidTable");else{if(e instanceof HTMLTableSectionElement)this.tableBody=e;else this.tableBody=this.table.tBodies[e];this.setTableHeaderEvents()}};e.prototype.iterateHeaderCells=function(t){var e,s,i,r,n,a;if(!this.table||!this.table.tHead)return;e=this.table.tHead.rows;if(e&&e.length>0){s=e[0].children;if(!s||!s.length)return;n=this;for(r=0;r<s.length;r++){i=s[r];a=t.call(this,i,r);if(void 0!==a)return a}}};e.prototype.setTableHeaderEvents=function(){var t=this,e=t.columns,s="ontouchstart"in window,i=s?"touchstart":"mousedown";if(!e)if(!t.dataIsArray)e=m;else return;this.iterateHeaderCells(function(s,r){s.setAttribute(v,e[r]);s.addEventListener(i,function(e){return c.call(this,e,t)})})};e.prototype.updateHeader=function(t){var e=this;this.iterateHeaderCells(function(s,i){var r=s.getAttribute(v),n=e.sortClass,a=e.sortClassDescending,o=e.sortClassAscending;if(!s.classList)return;if(t&&r===t){s.classList.add(n);s.classList.remove(!e.isReversed?a:o);s.classList.add(e.isReversed?a:o)}else{s.classList.remove(n);s.classList.remove(o);s.classList.remove(a)}})};l=function(t,e){var s,i=arguments.length>1&&!!arguments[1];s=function(e){var r,n;if(!e||"object"!==typeof e)return;t(e);if(!i)for(r in e)if(e.hasOwnProperty(r)){n=e[r];s(n)}};return s};e.prototype.watchTriggers=function(t){var e,s=this;if(!t||!A)return;h=function(){s.update()};o=l(function(t){Object.observe(t,h)},!this.isRecursive);for(e=0;e<t.length;e++){o(t[e]);if(!this.triggers)this.triggers=[];this.triggers.push(t[e])}};e.prototype.unwatchTriggers=function(){var t,e=this.triggers;if(!h||!e||!A)return;f=l(function(t){Object.unobserve(t,h)});for(t=0;t<e.length;t++)f(e[t]);h=null};e.prototype.movePage=function(t){var e=t||1,s=this.getPageTotal();if(!this.pageSize)return;this.viewPage(this.pageIndex+e)};e.prototype.viewPage=function(t){var e;if(!this.pageSize)return;e=this.getPageTotal();this.pageIndex=t;if(this.pageIndex<0)this.pageIndex=0;else if(this.pageIndex>e-1)this.pageIndex=Math.max(e-1,0);this.update()};e.prototype.getPageTotal=function(t){var e=0,s=this.dataIsArray,i=s?this.dataSort||this.data:this.keys,r=this.pageSize;if(r&&i&&i.length>0)e=Math.ceil(i.length/r);return e};c=function(t,e){var s,i,r=-1,n=this.parentNode.children;for(s=0;s<n.length;s++)if(n[s]===this){r=s;break}if(r>=0){i=this.getAttribute(v);if(e.dataSort)delete e.dataSort;e.sort(i);e.update(["Sort","Update"])}return a(t)};u=function(t,e,s){var i,r;if(s){i=t[s];r=e[s]}else{i=t;r=e}if(i!==r){if(i<r)return-1;if(i>r)return 1}return 0};a=function(t){if(t.stopPropagation)t.stopPropagation();if(t.preventDefault)t.preventDefault();t.cancelBubble=true;t.returnValue=false;return false};n=function(t,e,s){var i,r,n;for(i=0;i<e.length;i++){r="on"+e[i];n=s[r];if("function"===typeof n)t[r]=n}};r=function(t,e){var s,i=[];for(s in t)if(t.hasOwnProperty(s)&&e.indexOf(s)<0)i.push(s);i.sort();return i};i=function(t){var e=s[t],i=e.type||Error,r="Table Error: "+e.text;throw i(r)};s={invalidTable:{text:"Table is not valid."},invalidSettings:{text:"Settings are not valid."}};t.exports.TableView=e}(function(){if("undefined"===typeof module)return{exports:"undefined"===typeof document?{}:window};else return module}());