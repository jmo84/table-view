!function(){"use strict";var t="function"==typeof define&&define.amd,e="undefined"!=typeof document;function s(t,s,i){var r,n,o,a,l,f,u,h,c,d,p,g,v=1,m=2,y=["Change","Update"],b=["key","value"],C="data-column-key",A="#";r=function(t){var s=t;if(!s)o("invalidSettings");if(s.columns)this.columns=s.columns;if(s.columnAttributes)this.columnAttributes=s.columnAttributes;if(s.rowAttributes)this.rowAttributes=s.rowAttributes;if(e&&s.table)this.setTable(s.table,s.body||0);if(s.exclude)this.exclude=s.exclude;this.sortClass=s.sortClass||"sorted";this.sortClassAscending=s.sortClassAscending||"sorted-asc";this.sortClassDescending=s.sortClassDescending||"sorted-desc";this.isRecursive="undefined"===typeof s.isRecursive?true:s.isRecursive;if(s.formatter)if("function"===typeof s.formatter)this.cellFormatter=s.formatter;else this.cellFormatter=this.formatCellHtml;if(s.compareItems)if("function"===typeof s.compareItems)this.compareItems=s.compareItems;this.setData(s.data);if(s.triggers)this.watchTriggers(s.triggers);if(s.onProcess)this.onProcess=s.onProcess;l(this,this.updateEvents,s);if(s.sortColumn){this.sort(s.sortColumn);this.update()}};r.prototype.updateEvents=y;r.prototype.generateBody=function(){var t=this.dataIsArray,e=t?this.dataSort||this.data:this.keys,s=this.isReversed,i,r,n,o,a,l="";if(s){r=e.length-1;o=-1;n=0}else{n=e.length;r=0;o=1}for(i=r;s?i>=n:i<n;i+=o){a=e[i];if(t)l+=this.generateRowHtml(a,i);else l+=this.generateRowHtml(this.data,i,a)}return l};r.prototype.generateRowHtml=function(t,e,s){var i,r,n,o,a,l=this.sortColumn,f,u=this.columnAttributes,h=this.rowAttributes,c,d,p=this.columns,g=p?p.length:0,y=this.cellFormatter;if(s&&h){if(h[s])h=h?h[s]:null;c=h&&h.cellAttributes}r="<tr"+this.generateAttributeHtml(h)+">";for(i=0;i<g;i++){n=p[i];if(n===m)o=t[s];else if(n===v)o=s;else if(n===A)o=e.toString();else{o=t[n];if(n===l)f=true}if(c)d=h.cellAttributes[b[i]];else d=u?u[n]:null;if(f){a=this.sortClass+" "+(this.isReversed?this.sortClassDescending:this.sortClassAscending);if(!d)d={};if(!d["class"])d["class"]=a;else d["class"]+=" "+a;f=false}r+="<td"+this.generateAttributeHtml(d)+">";r+=(y?y.call(this,o,n,t,e):o)+"</td>"}return r+"</tr>"};r.prototype.generateAttributeHtml=function(t){var e,s,i="";if(!!t&&"object"===typeof t)for(e in t)if(t.hasOwnProperty(e)&&"cellAttributes"!==e){s=t[e];i+=" "+e+'="'+s+'"'}return i};r.prototype.formatCellJson=function(t){var e=JSON.stringify(t);return e};r.prototype.formatCellHtml=function(t){var e=t.toString();return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};r.prototype.update=function(t){var e,s,i,r;e=this.generateBody();this.tableBody.innerHTML=e;if(t&&t.length)for(s=0;s<t.length;s++){i="on"+t[s];r=this[i];if("function"===typeof r)r.call(this)}};r.prototype.processChanges=function(t){if("function"===typeof this.onProcess)if(false===this.onProcess(t))return;if(this.dataSort)delete this.dataSort;if(!this.dataIsArray)this.keys=a(this.data,this.exclude||[]);this.sort(this.sortColumn);this.update(this.updateEvents)};r.prototype.sort=function(t){var e,s,i,r,n,o;if(!t)return;if(this.sortColumn!=t){this.isReversed=!this.sortColumn&&t==A;this.sortColumn=t}else this.isReversed=!this.isReversed;if(t==A)return;if(this.dataIsArray)this.dataSort=this.data.slice(0);else{i=t===b[0];if(i)this.dataSort=this.keys.slice(0);else{s=true;this.dataSort=[];n=this.keys||[];for(o=0;o<n.length;o++){r=n[o];this.dataSort.push({key:r,value:this.data[r]})}}}if(this.compareItems){e=this;this.dataSort.sort(function(t,i){if(s)return e.compareItems(t.value,i.value);else return e.compareItems(t,i)})}else this.dataSort.sort(function(e,r){if(s)return p(e.value,r.value);else return p(e,r,i?null:t)});if(s){this.keys=[];for(o=0;o<this.dataSort.length;o++){r=this.dataSort[o].key;this.keys.push(r)}}else if(i)this.keys=this.dataSort;this.updateHeader(t)};r.prototype.releaseData=function(){var t;if(this.data){t=this.data;delete this.data;delete this.dataIsArray;if(this.observeChanges){Object.unobserve(t,this.observeChanges);delete this.observeChanges}}if(this.dataSort)delete this.dataSort};r.prototype.setData=function(t){var e=this;this.releaseData();if("undefined"===typeof t||"string"===typeof t)return this.setData(this.getDataFromTable(t));else if(t){this.data=t;this.dataIsArray=t instanceof Array;if(!this.dataIsArray){this.keys=a(t,this.exclude||[]);this.columns=[v,m]}this.observeChanges=function(t){e.processChanges(t)};c(function(t){Object.observe(t,e.observeChanges)},!this.isRecursive)(t)}this.sort(this.sortColumn)};r.prototype.getDataFromTable=function(t){var e=[],s,i,r,n,o,a,l,f=this.tableBody,u=this.columns;if(t){f=document.getElementById(t);if(f)f=f.tBodies[0]}if(f&&u){l=f.rows;if(l)for(s=0;s<l.length;s++){r=l[s];n={};for(i=0;i<r.children.length;i++){a=r.children[i].getAttribute("data-column-type");o=r.children[i].innerText;if(a){a=a.toLowerCase();if("date"===a)o=new Date(o);else if("number"===a)o=parseFloat(o)}if(u.length>0&&i<u.length)n[u[i]]=o}e.push(n)}}return e};r.prototype.setTable=function(t,e){if("string"===typeof t)this.table=document.getElementById(t);else this.table=t;if(!this.table instanceof HTMLTableElement)o("invalidTable");else{if(e instanceof HTMLTableSectionElement)this.tableBody=e;else this.tableBody=this.table.tBodies[e];this.setTableHeaderEvents()}};r.prototype.iterateHeaderCells=function(t){var e,s,i,r,n,o;if(!this.table||!this.table.tHead)return;e=this.table.tHead.rows;if(e&&e.length>0){s=e[0].children;if(!s||!s.length)return;n=this;for(r=0;r<s.length;r++){i=s[r];o=t.call(this,i,r);if(void 0!==o)return o}}};r.prototype.setTableHeaderEvents=function(){var t=this,e=t.columns,s="ontouchstart"in window,i=s?"touchstart":"mousedown";if(!e)if(!t.dataIsArray)e=b;else return;this.iterateHeaderCells(function(s,r){s.setAttribute(C,e[r]);s.addEventListener(i,function(e){return g.call(this,e,t)})})};r.prototype.updateHeader=function(t){var e=this;this.iterateHeaderCells(function(s,i){var r=s.getAttribute(C),n=e.sortClass,o=e.sortClassDescending,a=e.sortClassAscending;if(!s.classList)return;if(t&&r===t){s.classList.add(n);s.classList.remove(!e.isReversed?o:a);s.classList.add(e.isReversed?o:a)}else{s.classList.remove(n);s.classList.remove(a);s.classList.remove(o)}})};c=function(t,e){var s,i=arguments.length>1&&!!arguments[1];s=function(e){var r,n;if(!e||"object"!==typeof e)return;t(e);if(!i)for(r in e)if(e.hasOwnProperty(r)){n=e[r];s(n)}};return s};r.prototype.watchTriggers=function(t){var e,s=this;this.triggers=t;h=function(){s.update()};u=c(function(t){if("function"===typeof Object.observe)Object.observe(t,h)},!this.isRecursive);for(e=0;e<t.length;e++)u(t[e])};r.prototype.unwatchTriggers=function(){var t,e=this.triggers;if(!h||!e)return;d=c(function(t){Object.unobserve(t,h)});for(t=0;t<e.length;t++)d(e[t]);h=null};g=function(t,e){var s,i,r=-1,n=this.parentNode.children;for(s=0;s<n.length;s++)if(n[s]===this){r=s;break}if(r>=0){i=this.getAttribute(C);if(e.dataSort)delete e.dataSort;e.sort(i);e.update(["Sort","Update"])}return f(t)};p=function(t,e,s){var i,r;if(s){i=t[s];r=e[s]}else{i=t;r=e}if(i!==r){if(i<r)return-1;if(i>r)return 1}return 0};f=function(t){if(t.stopPropagation)t.stopPropagation();if(t.preventDefault)t.preventDefault();t.cancelBubble=true;t.returnValue=false;return false};l=function(t,e,s){var i,r,n;for(i=0;i<e.length;i++){r="on"+e[i];n=s[r];if("function"===typeof n)t[r]=n}};a=function(t,e){var s,i=[];for(s in t)if(t.hasOwnProperty(s)&&e.indexOf(s)<0)i.push(s);i.sort();return i};o=function(t){var e=n[t],s=e.type||Error,i="Table Error: "+e.text;throw s(i)};n={invalidTable:{text:"Table is not valid."},invalidSettings:{text:"Settings are not valid."}};s.TableView=r}function i(t){var e="undefined"!==typeof require?require:function(t){return window[t]},s="undefined"!==typeof exports?exports:window,i={exports:s};t(e,s,i)}function r(t){t(require,exports,module)}!function(t){t(s)}(t?define:e?i:r)}();